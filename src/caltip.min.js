/** CalTip - Another jQuery ToolTip
 * version 0.1.0
 * http://journalism.berkeley.edu
 * created by: Jeremy Rue @jrue
 *
 * Copyright (c) 2012 The Regents of the University of California
 * Released under the GPL Version 2 license
 * http://www.opensource.org/licenses/gpl-2.0.php
 * This program is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 */
;(function(c,d){var a=d(c).width(),b=d(c).height();d.caltip=function(h,o,k){var j=this,l=false,f=false,n=d(h),h=h,g={titlefont:"bold 16px/18px Arial,Helvetica,sans-serif",font:"normal 12px/16px Arial,Helvetica,sans-serif",padding:"10px",titlecolor:"#000000",bodycolor:"#787878",border:"1px solid #999",background:"#ffffff",boxshadow:"0 2px 4px rgba(0, 0, 0, 0.3)",borderRadius:"0px",zindex:9999,width:300,height:"auto",offsetleft:0,offsettop:0,title:null,content:"",notch:true,dataAttr:false,mouseevent:"mouseover",callback:function(){}};var i=d("<div />");j.settings={};j.init=function(){if(typeof o!=="undefined"){o=o.constructor==String?{content:o}:o;if(typeof k!=="undefined"&&k.constructor==String){o.title=k}if(o.hasOwnProperty("dataAttr")&&typeof n.attr("data-tooltip")!=="undefined"&&o.dataAttr){if(o.dataAttr.constructor==String&&typeof n.attr(o.dataAttr)!=="undefined"){o.content=n.attr(o.dataAttr)}else{o.content=n.attr("data-tooltip")}}}else{if(typeof n.attr("data-tooltip")!=="undefined"){o={content:n.attr("data-tooltip")}}else{o={content:n.text().substring(0,200)}}}if(n.parent().css("position")=="static"){n.parent().css({position:"relative"})}j.settings=d.extend({},g,o);i.css({position:"absolute",font:j.settings.font,color:j.settings.bodycolor,padding:j.settings.padding,border:j.settings.border,background:j.settings.background,"-moz-box-shadow":j.settings.boxshadow?j.settings.boxshadow:"none","-webkit-box-shadow":j.settings.boxshadow?j.settings.boxshadow:"none","box-shadow":j.settings.boxshadow?j.settings.boxshadow:"none","-moz-border-radius":j.settings.borderRadius?j.settings.borderRadius:"0px","-webkit-border-radius":j.settings.borderRadius?j.settings.borderRadius:"0px","border-radius":j.settings.borderRadius?j.settings.borderRadius:"0px","max-width":j.settings.width,"z-index":j.settings.zindex,"word-wrap":"break-word","text-align":"left",width:"auto",opacity:"0"});if(j.settings.title!==null&&j.settings.title.constructor==String){var p=d("<h2 />").css({font:j.settings.titlefont,color:j.settings.titlecolor,display:"block",margin:"0",padding:"0","text-align":"left"}).html(j.settings.title).appendTo(i)}i.append(j.settings.content.toString());d(document).on("touchstart touchcancel",j.destroyToolTip);if(j.settings.mouseevent=="click"){d(h).css({cursor:"pointer"});d(h).on(j.settings.mouseevent+" touchstart",function(q){if(f==false){f=true;j.activateToolTip(d(h),q)}else{f=false;j.destroyToolTip()}})}if(j.settings.mouseevent=="mouseover"){d(h).on(j.settings.mouseevent+" touchstart",function(q){f==false;j.activateToolTip(d(h),q)});d(h).on("mouseout",j.destroyToolTip)}};j.activateToolTip=function(q,p){q.parent().append(i);i.css({opacity:"1",display:"block",left:m(),top:e()});p=!p?c.event:p;p.cancelBubble=true;p.stopPropagation();if(((q.attr("href")!=null&&q.attr("href")!="#")||q.data("events").hasOwnProperty("click"))&&f==false){q.off("touchstart");q.on("click",function(r){j.destroyToolTip(q,r)});f=true}j.settings.callback();return false};j.destroyToolTip=function(q,p){i.stop().fadeOut(300,function(){i.remove()})};j.changeTitle=function(p){d("h2",i).html(p)};j.changeContent=function(q){var p=d("h2",i);i.empty();i.append(p).append(q.toString())};var m=function(){var p=i.outerWidth(),s=i.outerHeight(),q=((n.outerWidth()/2)+n.offset().left)-(p/2),r=((n.outerWidth()/2)+n.position().left)-(p/2)+j.settings.offsetleft;if(q+p>a){r-=(q+p)-a+3}if(q<0){r=3}return r};var e=function(){var q=i.outerHeight(),p=n.position().top-q+j.settings.offsettop;if(p+n.parent().offset().top<0){p=n.position().top+n.outerHeight()}return p};j.init()};d.fn.caltip=function(f,e){return this.each(function(){if(undefined==d(this).data("caltip")){var g=new d.caltip(this,f,e);d(this).data("caltip",g)}})}})(window,jQuery);