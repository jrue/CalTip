/** CalTip - Another jQuery ToolTip
 * version 0.1.0
 * http://journalism.berkeley.edu
 * created by: Jeremy Rue @jrue
 *
 * Copyright (c) 2012 The Regents of the University of California
 * Released under the GPL Version 2 license
 * http://www.opensource.org/licenses/gpl-2.0.php
 * This program is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 */
;(function(c,d){var a=d(c).width(),b=d(c).height(),e=d.browser.msie&&/MSIE\s(5\.5|6\.)/.test(navigator.userAgent);d.caltip=function(i,p,l){var k=this,m=false,g=false,o=d(i),i=i,h={titlefont:"bold 16px/18px Arial,Helvetica,sans-serif",font:"normal 12px/16px Arial,Helvetica,sans-serif",padding:"10px",titlecolor:"#000000",bodycolor:"#787878",border:"1px solid #999",background:"#ffffff",boxshadow:"0 2px 4px rgba(0, 0, 0, 0.3)",zindex:9999,width:300,height:"auto",offsetleft:0,offsettop:0,title:null,content:"",notch:true,dataAttr:false,mouseevent:"mouseover",callback:function(){}};var j=d("<div />");k.settings={};k.init=function(){if(typeof p!=="undefined"){p=p.constructor==String?{content:p}:p;if(typeof l!=="undefined"&&l.constructor==String){p.title=l}if(p.hasOwnProperty("dataAttr")&&typeof o.attr("data-tooltip")!=="undefined"&&p.dataAttr){if(p.dataAttr.constructor==String&&typeof o.attr(p.dataAttr)!=="undefined"){p.content=o.attr(p.dataAttr)}else{p.content=o.attr("data-tooltip")}}}else{if(typeof o.attr("data-tooltip")!=="undefined"){p={content:o.attr("data-tooltip")}}else{p={content:o.text().substring(0,200)}}}if(o.parent().css("position")=="static"){o.parent().css({position:"relative"})}k.settings=d.extend({},h,p);j.css({position:"absolute",font:k.settings.font,color:k.settings.bodycolor,padding:k.settings.padding,border:k.settings.border,background:k.settings.background,"-moz-box-shadow":k.settings.boxshadow?k.settings.boxshadow:"none","-webkit-box-shadow":k.settings.boxshadow?k.settings.boxshadow:"none","box-shadow":k.settings.boxshadow?k.settings.boxshadow:"none","max-width":k.settings.width,"z-index":k.settings.zindex,"word-wrap":"break-word","text-align":"left",width:"auto",opacity:"0"});if(k.settings.title!==null&&k.settings.title.constructor==String){var q=d("<h2 />").css({font:k.settings.titlefont,color:k.settings.titlecolor,display:"block",margin:"0",padding:"0","text-align":"left"}).html(k.settings.title).appendTo(j)}j.append(k.settings.content.toString());d(document).on("touchstart touchcancel",k.destroyToolTip);if(k.settings.mouseevent=="click"){d(i).css({cursor:"pointer"});d(i).on(k.settings.mouseevent+" touchstart",function(r){if(g==false){g=true;k.activateToolTip(d(i),r)}else{g=false;k.destroyToolTip()}})}if(k.settings.mouseevent=="mouseover"){d(i).on(k.settings.mouseevent+" touchstart",function(r){g==false;k.activateToolTip(d(i),r)});d(i).on("mouseout",k.destroyToolTip)}};k.activateToolTip=function(r,q){r.parent().append(j);j.css({opacity:"1",display:"block",left:n(),top:f()});q=!q?c.event:q;q.cancelBubble=true;q.stopPropagation();if(((r.attr("href")!=null&&r.attr("href")!="#")||r.data("events").hasOwnProperty("click"))&&g==false){r.off("touchstart");r.on("click",function(s){k.destroyToolTip(r,s)});g=true}k.settings.callback();return false};k.destroyToolTip=function(r,q){j.stop().fadeOut(300,function(){j.remove()})};var n=function(){var q=j.outerWidth(),t=j.outerHeight(),r=((o.outerWidth()/2)+o.offset().left)-(q/2),s=((o.outerWidth()/2)+o.position().left)-(q/2)+k.settings.offsetleft;if(r+q>a){s-=(r+q)-a+3}if(r<0){s=3}return s};var f=function(){var r=j.outerHeight(),q=o.position().top-r+k.settings.offsettop;if(q+o.parent().offset().top<0){q=o.position().top+o.outerHeight();switchNotch()}return q};k.init()};d.fn.caltip=function(g,f){return this.each(function(){if(undefined==d(this).data("caltip")){var h=new d.caltip(this,g,f);d(this).data("caltip",h)}})}})(window,jQuery);